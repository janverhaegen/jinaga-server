{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"jinaga\"","webpack:///./src/util/fn.ts","webpack:///./src/postgres/connection.ts","webpack:///./src/index.ts","webpack:///./src/jinaga-server.ts","webpack:///./src/authentication/authentication-device.ts","webpack:///./src/authentication/authentication-session.ts","webpack:///./src/authorization/authorization-keystore.ts","webpack:///./src/http/node-http.ts","webpack:///external \"http\"","webpack:///external \"https\"","webpack:///external \"url\"","webpack:///./src/http/router.ts","webpack:///external \"express\"","webpack:///./src/postgres/postgres-keystore.ts","webpack:///external \"node-forge\"","webpack:///external \"pg\"","webpack:///./src/postgres/postgres-store.ts","webpack:///./src/postgres/edge-record.ts","webpack:///./src/postgres/sql.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","g","_","label","sent","trys","ops","verb","iterator","v","op","TypeError","pop","length","push","safeFlatten","results","flat","reduce","a","b","concat","distinct","findIndex","filterAsync","mapAsync","flatten","flattenAsync","collection","selector","_a","all","map","action","predicate","_this","element","_b","include","filter","array","index","self","indexOf","ConnectionFactory","pg_1","postgresUri","postgresPool","Pool","connectionString","withTransaction","callback","with","connection","e_1","query","client","createClient","release","connect","jinaga_server_1","JinagaServer","jinaga_1","authentication_device_1","authentication_session_1","authorization_keystore_1","node_http_1","router_1","postgres_keystore_1","postgres_store_1","localDeviceIdentity","provider","id","config","syncStatusNotifier","SyncStatusNotifier","store","pgStore","PostgresStore","Cache","MemoryStore","createStore","feed","FeedImpl","fork","httpEndpoint","httpConnection","NodeHttpConnection","httpTimeoutSeconds","webClient","WebClient","timeoutSeconds","TransientFork","createFork","authorization","pgKeystore","keystore","PostgresKeystore","authorizationRules","AuthorizationRules","AuthorizationKeystore","AuthorizationNoOp","createAuthorization","router","HttpRouter","authentication","AuthenticationDevice","memory","j","Jinaga","handler","withSession","req","user","userIdentity","AuthenticationSession","profile","displayName","inner","login","Error","local","getDeviceFact","from","fact","save","envelopes","start","exists","load","references","getUserFact","userFact","fn_1","authorizationEngine","AuthorizationEngine","signatures","facts","authorizedFacts","signedFacts","envelope","authorizeFacts","signFact","http","https","url","path","parse","protocol","data","response","on","chunk","JSON","x","err","post","tail","host","port","request","method","headers","timeout","res","Buffer","toString","error","message","statusCode","split","json","write","stringify","end","express_1","jinaga_2","jinaga_3","setHeader","send","catch","Forbidden","Trace","warn","status","sendStatus","serializeUserIdentity","Router","queryMessage","loadMessage","saveMessage","fromDescriptiveString","node_forge_1","connection_1","connectionFactory","getIdentityFact","deviceIdentity","publicPem","privatePem","privateKey","canonicalString","encodedString","digest","hash","signature","publicKey","getPrivateKey","pki","privateKeyFromPem","canonicalizeFact","fields","predecessors","util","encodeUtf8","md","sha512","update","encode64","getBytes","sign","publicKeyFromPem","verify","decode64","type","identity","getPublicKey","computeHash","rows","generateKeyPair","keypair","rsa","bits","privateKeyToPem","publicKeyToPem","edge_record_1","sql_1","loadFactRecord","loadFactReference","facts_1","some","newFacts","filterNewFacts","insertEdges","insertFacts","insertSignatures","factReferenceEquals","sqlQuery","steps","sqlFromSteps","toDescriptiveString","sql","parameters","row","pathLength","loadFactPath","count","tuples","join","factValues","factParameters","newFactReferences_1","edgeRecords","edgeValues","edgeParameters","makeEdgeRecords","predecessor_hash","predecessor_type","successor_hash","successor_type","role","signatureRecords","signatureValues","signatureParameters","makeEdgeRecord","predecessor","successor","records","_loop_1","Array","isArray","QueryBuilder","buildQuery","nextAlias","final","state","transition","stateStart","parts","assembleQueryString","prefixes","prefix","fromClause","joins","whereClause","buildChildQuery","stateSubquery","assembleChildQueryString","transitionFromStart","Join","direction","Direction","Successor","handleStartSuccessor","Predecessor","handleStartPredecessor","PropertyCondition","handleStartType","toDeclarativeString","alias","allocateAlias","addParameter","stateMatched","transitionFromSubquery","handleSubquerySuccessor","handleSubqueryPredecessor","outerPrefix","transitionFromMatched","handleMatchedType","handleMatchedSuccessor","handleMatchedPredecessor","ExistentialCondition","handleMatchedExistentialCondition","quantifier","roleParameter","priorPrefix","existence","Quantifier","Exists","childQuery"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = require(\"jinaga\");","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.distinct = exports.findIndex = exports.filterAsync = exports.mapAsync = exports.flatten = exports.flattenAsync = void 0;\nfunction safeFlatten(results) {\n    var flat = results.reduce(function (a, b) {\n        return (!a || a.length === 0) ? b :\n            (!b || b.length === 0) ? a :\n                a.concat(b);\n    });\n    return flat ? flat : [];\n}\nfunction flattenAsync(collection, selector) {\n    return __awaiter(this, void 0, void 0, function () {\n        var results;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(collection.length === 0)) return [3 /*break*/, 1];\n                    return [2 /*return*/, []];\n                case 1: return [4 /*yield*/, Promise.all(collection.map(selector))];\n                case 2:\n                    results = _a.sent();\n                    return [2 /*return*/, safeFlatten(results)];\n            }\n        });\n    });\n}\nexports.flattenAsync = flattenAsync;\nfunction flatten(collection, selector) {\n    if (collection.length === 0) {\n        return [];\n    }\n    else {\n        return safeFlatten(collection.map(selector));\n    }\n}\nexports.flatten = flatten;\nfunction mapAsync(collection, action) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(collection.length === 0)) return [3 /*break*/, 1];\n                    return [2 /*return*/, []];\n                case 1: return [4 /*yield*/, Promise.all(collection.map(action))];\n                case 2: return [2 /*return*/, _a.sent()];\n            }\n        });\n    });\n}\nexports.mapAsync = mapAsync;\nfunction filterAsync(collection, predicate) {\n    return __awaiter(this, void 0, void 0, function () {\n        var filters;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(collection.length === 0)) return [3 /*break*/, 1];\n                    return [2 /*return*/, []];\n                case 1: return [4 /*yield*/, Promise.all(collection.map(function (element) { return __awaiter(_this, void 0, void 0, function () {\n                        var _a;\n                        return __generator(this, function (_b) {\n                            switch (_b.label) {\n                                case 0:\n                                    _a = {};\n                                    return [4 /*yield*/, predicate(element)];\n                                case 1: return [2 /*return*/, (_a.include = _b.sent(),\n                                        _a.element = element,\n                                        _a)];\n                            }\n                        });\n                    }); }))];\n                case 2:\n                    filters = _a.sent();\n                    return [2 /*return*/, filters.filter(function (f) { return f.include; }).map(function (f) { return f.element; })];\n            }\n        });\n    });\n}\nexports.filterAsync = filterAsync;\nfunction findIndex(array, predicate) {\n    for (var index = 0; index < array.length; index++) {\n        if (predicate(array[index])) {\n            return index;\n        }\n    }\n    return -1;\n}\nexports.findIndex = findIndex;\nfunction distinct(value, index, self) {\n    return self.indexOf(value) === index;\n}\nexports.distinct = distinct;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ConnectionFactory = void 0;\nvar pg_1 = require(\"pg\");\nvar ConnectionFactory = /** @class */ (function () {\n    function ConnectionFactory(postgresUri) {\n        this.postgresPool = new pg_1.Pool({\n            connectionString: postgresUri\n        });\n    }\n    ConnectionFactory.prototype.withTransaction = function (callback) {\n        var _this = this;\n        return this.with(function (connection) { return __awaiter(_this, void 0, void 0, function () {\n            var result, e_1;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        _a.trys.push([0, 4, , 6]);\n                        return [4 /*yield*/, connection.query('BEGIN')];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, callback(connection)];\n                    case 2:\n                        result = _a.sent();\n                        return [4 /*yield*/, connection.query('COMMIT')];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/, result];\n                    case 4:\n                        e_1 = _a.sent();\n                        return [4 /*yield*/, connection.query('ROLLBACK')];\n                    case 5:\n                        _a.sent();\n                        throw e_1;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        }); });\n    };\n    ConnectionFactory.prototype.with = function (callback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var client;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.createClient()];\n                    case 1:\n                        client = _a.sent();\n                        _a.label = 2;\n                    case 2:\n                        _a.trys.push([2, , 4, 5]);\n                        return [4 /*yield*/, callback(client)];\n                    case 3: return [2 /*return*/, _a.sent()];\n                    case 4:\n                        client.release();\n                        return [7 /*endfinally*/];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ConnectionFactory.prototype.createClient = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.postgresPool.connect()];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    return ConnectionFactory;\n}());\nexports.ConnectionFactory = ConnectionFactory;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar jinaga_server_1 = require(\"./jinaga-server\");\nObject.defineProperty(exports, \"JinagaServer\", { enumerable: true, get: function () { return jinaga_server_1.JinagaServer; } });\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.JinagaServer = void 0;\nvar jinaga_1 = require(\"jinaga\");\nvar authentication_device_1 = require(\"./authentication/authentication-device\");\nvar authentication_session_1 = require(\"./authentication/authentication-session\");\nvar authorization_keystore_1 = require(\"./authorization/authorization-keystore\");\nvar node_http_1 = require(\"./http/node-http\");\nvar router_1 = require(\"./http/router\");\nvar postgres_keystore_1 = require(\"./postgres/postgres-keystore\");\nvar postgres_store_1 = require(\"./postgres/postgres-store\");\nvar localDeviceIdentity = {\n    provider: 'jinaga',\n    id: 'local'\n};\nvar JinagaServer = /** @class */ (function () {\n    function JinagaServer() {\n    }\n    JinagaServer.create = function (config) {\n        var syncStatusNotifier = new jinaga_1.SyncStatusNotifier();\n        var store = createStore(config);\n        var feed = new jinaga_1.FeedImpl(store);\n        var fork = createFork(config, feed, syncStatusNotifier);\n        var authorization = createAuthorization(config, fork);\n        var router = new router_1.HttpRouter(authorization);\n        var keystore = new postgres_keystore_1.PostgresKeystore(config.pgKeystore);\n        var authentication = new authentication_device_1.AuthenticationDevice(fork, keystore, localDeviceIdentity);\n        var memory = new jinaga_1.MemoryStore();\n        var j = new jinaga_1.Jinaga(authentication, memory, syncStatusNotifier);\n        return {\n            handler: router.handler,\n            j: j,\n            withSession: function (req, callback) {\n                return withSession(feed, keystore, req, callback);\n            }\n        };\n    };\n    return JinagaServer;\n}());\nexports.JinagaServer = JinagaServer;\nfunction createStore(config) {\n    if (config.pgStore) {\n        var store = new postgres_store_1.PostgresStore(config.pgStore);\n        var cache = new jinaga_1.Cache(store);\n        return cache;\n    }\n    else {\n        return new jinaga_1.MemoryStore();\n    }\n}\nfunction createFork(config, feed, syncStatusNotifier) {\n    if (config.httpEndpoint) {\n        var httpConnection = new node_http_1.NodeHttpConnection(config.httpEndpoint);\n        var httpTimeoutSeconds = config.httpTimeoutSeconds || 5;\n        var webClient = new jinaga_1.WebClient(httpConnection, syncStatusNotifier, {\n            timeoutSeconds: httpTimeoutSeconds\n        });\n        var fork = new jinaga_1.TransientFork(feed, webClient);\n        return fork;\n    }\n    else {\n        return feed;\n    }\n}\nfunction createAuthorization(config, feed) {\n    if (config.pgKeystore) {\n        var keystore = new postgres_keystore_1.PostgresKeystore(config.pgKeystore);\n        var authorizationRules = config.authorization ? config.authorization(new jinaga_1.AuthorizationRules()) : null;\n        var authorization = new authorization_keystore_1.AuthorizationKeystore(feed, keystore, authorizationRules);\n        return authorization;\n    }\n    else {\n        return new jinaga_1.AuthorizationNoOp(feed);\n    }\n}\nfunction withSession(feed, keystore, req, callback) {\n    return __awaiter(this, void 0, void 0, function () {\n        var user, userIdentity, authentication, syncStatusNotifier, j;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    user = req.user;\n                    userIdentity = {\n                        provider: user.provider,\n                        id: user.id\n                    };\n                    authentication = new authentication_session_1.AuthenticationSession(feed, keystore, userIdentity, user.profile.displayName, localDeviceIdentity);\n                    syncStatusNotifier = new jinaga_1.SyncStatusNotifier();\n                    j = new jinaga_1.Jinaga(authentication, new jinaga_1.MemoryStore(), syncStatusNotifier);\n                    return [4 /*yield*/, callback(j)];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuthenticationDevice = void 0;\nvar AuthenticationDevice = /** @class */ (function () {\n    function AuthenticationDevice(inner, keystore, localDeviceIdentity) {\n        this.inner = inner;\n        this.keystore = keystore;\n        this.localDeviceIdentity = localDeviceIdentity;\n    }\n    AuthenticationDevice.prototype.login = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                throw new Error('No logged in user.');\n            });\n        });\n    };\n    AuthenticationDevice.prototype.local = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.keystore.getDeviceFact(this.localDeviceIdentity)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    AuthenticationDevice.prototype.from = function (fact, query) {\n        return this.inner.from(fact, query);\n    };\n    AuthenticationDevice.prototype.save = function (envelopes) {\n        return this.inner.save(envelopes);\n    };\n    AuthenticationDevice.prototype.query = function (start, query) {\n        return this.inner.query(start, query);\n    };\n    AuthenticationDevice.prototype.exists = function (fact) {\n        throw new Error(\"Exists method not implemented on AuthenticationDevice.\");\n    };\n    AuthenticationDevice.prototype.load = function (references) {\n        return this.inner.load(references);\n    };\n    return AuthenticationDevice;\n}());\nexports.AuthenticationDevice = AuthenticationDevice;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuthenticationSession = void 0;\nvar AuthenticationSession = /** @class */ (function () {\n    function AuthenticationSession(inner, keystore, userIdentity, displayName, localDeviceIdentity) {\n        this.inner = inner;\n        this.keystore = keystore;\n        this.userIdentity = userIdentity;\n        this.displayName = displayName;\n        this.localDeviceIdentity = localDeviceIdentity;\n    }\n    AuthenticationSession.prototype.login = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var userFact;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.keystore.getUserFact(this.userIdentity)];\n                    case 1:\n                        userFact = _a.sent();\n                        return [2 /*return*/, {\n                                userFact: userFact,\n                                profile: {\n                                    displayName: this.displayName\n                                }\n                            }];\n                }\n            });\n        });\n    };\n    AuthenticationSession.prototype.local = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.keystore.getDeviceFact(this.localDeviceIdentity)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    AuthenticationSession.prototype.from = function (fact, query) {\n        return this.inner.from(fact, query);\n    };\n    AuthenticationSession.prototype.save = function (envelopes) {\n        return this.inner.save(envelopes);\n    };\n    AuthenticationSession.prototype.query = function (start, query) {\n        return this.inner.query(start, query);\n    };\n    AuthenticationSession.prototype.exists = function (fact) {\n        throw new Error(\"Exists method not implemented on AuthenticationSession.\");\n    };\n    AuthenticationSession.prototype.load = function (references) {\n        return this.inner.load(references);\n    };\n    return AuthenticationSession;\n}());\nexports.AuthenticationSession = AuthenticationSession;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuthorizationKeystore = void 0;\nvar fn_1 = require(\"../util/fn\");\nvar jinaga_1 = require(\"jinaga\");\nvar AuthorizationKeystore = /** @class */ (function () {\n    function AuthorizationKeystore(feed, keystore, authorizationRules) {\n        this.feed = feed;\n        this.keystore = keystore;\n        this.authorizationEngine = authorizationRules &&\n            new jinaga_1.AuthorizationEngine(authorizationRules, feed);\n    }\n    AuthorizationKeystore.prototype.getUserFact = function (userIdentity) {\n        return __awaiter(this, void 0, void 0, function () {\n            var userFact, envelopes;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.keystore.getUserFact(userIdentity)];\n                    case 1:\n                        userFact = _a.sent();\n                        envelopes = [\n                            {\n                                fact: userFact,\n                                signatures: []\n                            }\n                        ];\n                        return [4 /*yield*/, this.feed.save(envelopes)];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/, userFact];\n                }\n            });\n        });\n    };\n    AuthorizationKeystore.prototype.query = function (userIdentity, start, query) {\n        return this.feed.query(start, query);\n    };\n    AuthorizationKeystore.prototype.load = function (userIdentity, references) {\n        return this.feed.load(references);\n    };\n    AuthorizationKeystore.prototype.save = function (userIdentity, facts) {\n        return __awaiter(this, void 0, void 0, function () {\n            var envelopes_1, userFact, authorizedFacts, signedFacts, envelopes;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!!this.authorizationEngine) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.feed.save(facts.map(function (fact) { return ({\n                                fact: fact,\n                                signatures: []\n                            }); }))];\n                    case 1:\n                        envelopes_1 = _a.sent();\n                        return [2 /*return*/, envelopes_1.map(function (envelope) { return envelope.fact; })];\n                    case 2: return [4 /*yield*/, this.keystore.getUserFact(userIdentity)];\n                    case 3:\n                        userFact = _a.sent();\n                        return [4 /*yield*/, this.authorizationEngine.authorizeFacts(facts, userFact)];\n                    case 4:\n                        authorizedFacts = _a.sent();\n                        return [4 /*yield*/, fn_1.mapAsync(authorizedFacts, function (fact) { return __awaiter(_this, void 0, void 0, function () {\n                                var _a;\n                                return __generator(this, function (_b) {\n                                    switch (_b.label) {\n                                        case 0:\n                                            _a = {\n                                                fact: fact\n                                            };\n                                            return [4 /*yield*/, this.keystore.signFact(userIdentity, fact)];\n                                        case 1: return [2 /*return*/, (_a.signatures = _b.sent(),\n                                                _a)];\n                                    }\n                                });\n                            }); })];\n                    case 5:\n                        signedFacts = _a.sent();\n                        return [4 /*yield*/, this.feed.save(signedFacts)];\n                    case 6:\n                        envelopes = _a.sent();\n                        return [2 /*return*/, envelopes.map(function (envelope) { return envelope.fact; })];\n                }\n            });\n        });\n    };\n    return AuthorizationKeystore;\n}());\nexports.AuthorizationKeystore = AuthorizationKeystore;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.NodeHttpConnection = void 0;\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar url = require(\"url\");\nvar NodeHttpConnection = /** @class */ (function () {\n    function NodeHttpConnection(url) {\n        this.url = url;\n    }\n    NodeHttpConnection.prototype.get = function (path) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var protocol = url.parse(_this.url + path).protocol;\n            var get = protocol === \"https:\" ? https.get : http.get;\n            var data = \"\";\n            get(_this.url + path, function (response) {\n                response.on(\"data\", function (chunk) {\n                    data += chunk;\n                });\n                response.on(\"end\", function () {\n                    try {\n                        var result = JSON.parse(data);\n                        resolve(result);\n                    }\n                    catch (x) {\n                        reject(x);\n                    }\n                });\n            }).on(\"error\", function (err) { return reject(err); });\n        });\n    };\n    NodeHttpConnection.prototype.post = function (tail, body, timeoutSeconds) {\n        var _this = this;\n        return new Promise(function (resolve, reject) {\n            var _a = url.parse(_this.url + tail), protocol = _a.protocol, host = _a.host, port = _a.port, path = _a.path;\n            var request = protocol === \"https:\" ? https.request : http.request;\n            var response = \"\";\n            var req = request({\n                method: \"POST\",\n                host: host, port: port, path: path,\n                headers: {\n                    \"Accept\": \"application/json\",\n                    \"Content-Type\": \"application/json\"\n                },\n                timeout: timeoutSeconds * 1000\n            }, function (res) {\n                res.on(\"data\", function (chunk) {\n                    if (chunk instanceof Buffer) {\n                        response += chunk.toString();\n                    }\n                    else {\n                        response += chunk;\n                    }\n                });\n                res.on(\"error\", function (err) {\n                    resolve({\n                        result: \"failure\",\n                        error: err.message\n                    });\n                });\n                res.on(\"end\", function () {\n                    if (res.statusCode === 403) {\n                        reject(response);\n                    }\n                    else if (res.statusCode >= 400) {\n                        resolve({\n                            result: \"retry\",\n                            error: response\n                        });\n                    }\n                    else if (isJsonResult(res.headers[\"content-type\"])) {\n                        try {\n                            var json = JSON.parse(response);\n                            resolve({\n                                result: \"success\",\n                                response: json\n                            });\n                        }\n                        catch (x) {\n                            reject(x);\n                        }\n                    }\n                    else {\n                        reject(response);\n                    }\n                });\n            });\n            req.on(\"error\", function (err) {\n                resolve({\n                    result: \"failure\",\n                    error: err.message\n                });\n            });\n            req.write(JSON.stringify(body));\n            req.end();\n        });\n    };\n    return NodeHttpConnection;\n}());\nexports.NodeHttpConnection = NodeHttpConnection;\nfunction isJsonResult(contentType) {\n    var json = contentType.split(\";\").indexOf(\"application/json\");\n    return json >= 0;\n}\n","module.exports = require(\"http\");","module.exports = require(\"https\");","module.exports = require(\"url\");","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HttpRouter = void 0;\nvar express_1 = require(\"express\");\nvar jinaga_1 = require(\"jinaga\");\nvar jinaga_2 = require(\"jinaga\");\nvar jinaga_3 = require(\"jinaga\");\nfunction get(method) {\n    return function (req, res, next) {\n        var user = req.user;\n        if (!user) {\n            res.sendStatus(401);\n        }\n        else {\n            method(user)\n                .then(function (response) {\n                res.setHeader('Content-Type', 'application/json');\n                res.send(JSON.stringify(response));\n                next();\n            })\n                .catch(function (error) {\n                jinaga_3.Trace.error(error);\n                res.sendStatus(500);\n                next();\n            });\n        }\n    };\n}\nfunction post(method) {\n    return function (req, res, next) {\n        var user = req.user;\n        var message = req.body;\n        if (!message) {\n            throw new Error('Ensure that you have installed body-parser and called app.use(bodyParser.json()).');\n        }\n        method(user, message)\n            .then(function (response) {\n            res.setHeader('Content-Type', 'application/json');\n            res.send(JSON.stringify(response));\n            next();\n        })\n            .catch(function (error) {\n            if (error instanceof jinaga_1.Forbidden) {\n                jinaga_3.Trace.warn(error.message);\n                res.status(403).send(error.message);\n            }\n            else {\n                jinaga_3.Trace.error(error);\n                res.sendStatus(500);\n            }\n            next();\n        });\n    };\n}\nfunction serializeUserIdentity(user) {\n    if (!user) {\n        return null;\n    }\n    return {\n        provider: user.provider,\n        id: user.id\n    };\n}\nvar HttpRouter = /** @class */ (function () {\n    function HttpRouter(authorization) {\n        var _this = this;\n        this.authorization = authorization;\n        var router = express_1.Router();\n        router.get('/login', get(function (user) { return _this.login(user); }));\n        router.post('/query', post(function (user, queryMessage) { return _this.query(user, queryMessage); }));\n        router.post('/load', post(function (user, loadMessage) { return _this.load(user, loadMessage); }));\n        router.post('/save', post(function (user, saveMessage) { return _this.save(user, saveMessage); }));\n        this.handler = router;\n    }\n    HttpRouter.prototype.login = function (user) {\n        return __awaiter(this, void 0, void 0, function () {\n            var userFact;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.authorization.getUserFact({\n                            provider: user.provider,\n                            id: user.id\n                        })];\n                    case 1:\n                        userFact = _a.sent();\n                        return [2 /*return*/, {\n                                userFact: userFact,\n                                profile: user.profile\n                            }];\n                }\n            });\n        });\n    };\n    HttpRouter.prototype.query = function (user, queryMessage) {\n        return __awaiter(this, void 0, void 0, function () {\n            var userIdentity, query, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        userIdentity = serializeUserIdentity(user);\n                        query = jinaga_2.fromDescriptiveString(queryMessage.query);\n                        return [4 /*yield*/, this.authorization.query(userIdentity, queryMessage.start, query)];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, {\n                                results: result\n                            }];\n                }\n            });\n        });\n    };\n    HttpRouter.prototype.load = function (user, loadMessage) {\n        return __awaiter(this, void 0, void 0, function () {\n            var userIdentity, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        userIdentity = serializeUserIdentity(user);\n                        return [4 /*yield*/, this.authorization.load(userIdentity, loadMessage.references)];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, {\n                                facts: result\n                            }];\n                }\n            });\n        });\n    };\n    HttpRouter.prototype.save = function (user, saveMessage) {\n        return __awaiter(this, void 0, void 0, function () {\n            var userIdentity;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        userIdentity = serializeUserIdentity(user);\n                        return [4 /*yield*/, this.authorization.save(userIdentity, saveMessage.facts)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, {}];\n                }\n            });\n        });\n    };\n    return HttpRouter;\n}());\nexports.HttpRouter = HttpRouter;\n","module.exports = require(\"express\");","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PostgresKeystore = void 0;\nvar node_forge_1 = require(\"node-forge\");\nvar jinaga_1 = require(\"jinaga\");\nvar jinaga_2 = require(\"jinaga\");\nvar connection_1 = require(\"./connection\");\nvar PostgresKeystore = /** @class */ (function () {\n    function PostgresKeystore(postgresUri) {\n        this.connectionFactory = new connection_1.ConnectionFactory(postgresUri);\n    }\n    PostgresKeystore.prototype.getUserFact = function (userIdentity) {\n        return this.getIdentityFact('Jinaga.User', userIdentity);\n    };\n    PostgresKeystore.prototype.getDeviceFact = function (deviceIdentity) {\n        return this.getIdentityFact('Jinaga.Device', deviceIdentity);\n    };\n    PostgresKeystore.prototype.signFact = function (userIdentity, fact) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!userIdentity) {\n                            return [2 /*return*/, []];\n                        }\n                        return [4 /*yield*/, this.connectionFactory.withTransaction(function (connection) { return __awaiter(_this, void 0, void 0, function () {\n                                var _a, publicPem, privatePem, privateKey, canonicalString, encodedString, digest, hash, signature, publicKey, verified;\n                                return __generator(this, function (_b) {\n                                    switch (_b.label) {\n                                        case 0: return [4 /*yield*/, this.getPrivateKey(connection, userIdentity)];\n                                        case 1:\n                                            _a = _b.sent(), publicPem = _a.publicKey, privatePem = _a.privateKey;\n                                            privateKey = node_forge_1.pki.privateKeyFromPem(privatePem);\n                                            canonicalString = jinaga_1.canonicalizeFact(fact.fields, fact.predecessors);\n                                            encodedString = node_forge_1.util.encodeUtf8(canonicalString);\n                                            digest = node_forge_1.md.sha512.create().update(encodedString);\n                                            hash = node_forge_1.util.encode64(digest.digest().getBytes());\n                                            if (fact.hash !== hash) {\n                                                jinaga_2.Trace.error(\"Hash does not match. \\\"\" + fact.hash + \"\\\" !== \\\"\" + hash + \"\\\"\\nFact: \" + canonicalString);\n                                                return [2 /*return*/, []];\n                                            }\n                                            signature = node_forge_1.util.encode64(privateKey.sign(digest));\n                                            publicKey = node_forge_1.pki.publicKeyFromPem(publicPem);\n                                            verified = publicKey.verify(digest.digest().getBytes(), node_forge_1.util.decode64(signature));\n                                            if (!verified) {\n                                                jinaga_2.Trace.error(\"The signature did not verify correctly.\\nHash: \" + hash + \"\\nSignature: \" + signature + \"\\nFact: \" + canonicalString + \"\\n\" + publicPem);\n                                                return [2 /*return*/, []];\n                                            }\n                                            return [2 /*return*/, [{\n                                                        signature: signature,\n                                                        publicKey: publicPem\n                                                    }]];\n                                    }\n                                });\n                            }); })];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    PostgresKeystore.prototype.getIdentityFact = function (type, identity) {\n        var _this = this;\n        if (!identity) {\n            return null;\n        }\n        return this.connectionFactory.withTransaction(function (connection) { return __awaiter(_this, void 0, void 0, function () {\n            var publicKey, predecessors, fields, hash;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getPublicKey(connection, identity)];\n                    case 1:\n                        publicKey = _a.sent();\n                        predecessors = {};\n                        fields = {\n                            publicKey: publicKey\n                        };\n                        hash = jinaga_1.computeHash(fields, predecessors);\n                        return [2 /*return*/, { type: type, hash: hash, predecessors: predecessors, fields: fields }];\n                }\n            });\n        }); });\n    };\n    PostgresKeystore.prototype.getPublicKey = function (connection, userIdentity) {\n        return __awaiter(this, void 0, void 0, function () {\n            var rows;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, connection.query('SELECT public_key FROM public.user WHERE provider = $1 AND user_id = $2', [userIdentity.provider, userIdentity.id])];\n                    case 1:\n                        rows = (_a.sent()).rows;\n                        if (rows.length > 1) {\n                            throw new Error('Duplicate entries found in the keystore');\n                        }\n                        else if (rows.length === 1) {\n                            return [2 /*return*/, rows[0][\"public_key\"]];\n                        }\n                        else {\n                            return [2 /*return*/, this.generateKeyPair(connection, userIdentity)];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PostgresKeystore.prototype.getPrivateKey = function (connection, userIdentity) {\n        return __awaiter(this, void 0, void 0, function () {\n            var rows, publicKey, privateKey;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, connection.query('SELECT public_key, private_key FROM public.user WHERE provider = $1 AND user_id = $2', [userIdentity.provider, userIdentity.id])];\n                    case 1:\n                        rows = (_a.sent()).rows;\n                        if (rows.length > 1) {\n                            throw new Error('Duplicate entries found in the keystore');\n                        }\n                        else if (rows.length === 1) {\n                            publicKey = rows[0][\"public_key\"];\n                            privateKey = rows[0][\"private_key\"];\n                            return [2 /*return*/, { publicKey: publicKey, privateKey: privateKey }];\n                        }\n                        else {\n                            throw new Error('No entry found in the keystore');\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    PostgresKeystore.prototype.generateKeyPair = function (connection, userIdentity) {\n        return __awaiter(this, void 0, void 0, function () {\n            var keypair, privateKey, publicKey;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        keypair = node_forge_1.pki.rsa.generateKeyPair({ bits: 2048 });\n                        privateKey = node_forge_1.pki.privateKeyToPem(keypair.privateKey);\n                        publicKey = node_forge_1.pki.publicKeyToPem(keypair.publicKey);\n                        return [4 /*yield*/, connection.query('INSERT INTO public.user (provider, user_id, private_key, public_key) VALUES ($1, $2, $3, $4)', [userIdentity.provider, userIdentity.id, privateKey, publicKey])];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, publicKey];\n                }\n            });\n        });\n    };\n    return PostgresKeystore;\n}());\nexports.PostgresKeystore = PostgresKeystore;\n","module.exports = require(\"node-forge\");","module.exports = require(\"pg\");","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PostgresStore = void 0;\nvar jinaga_1 = require(\"jinaga\");\nvar fn_1 = require(\"../util/fn\");\nvar connection_1 = require(\"./connection\");\nvar edge_record_1 = require(\"./edge-record\");\nvar sql_1 = require(\"./sql\");\nfunction loadFactRecord(r) {\n    return {\n        type: r.type,\n        hash: r.hash,\n        predecessors: JSON.parse(r.predecessors),\n        fields: JSON.parse(r.fields)\n    };\n}\nfunction loadFactReference(r) {\n    return {\n        type: r.type,\n        hash: r.hash\n    };\n}\nfunction loadFactPath(pathLength, r) {\n    var path = [];\n    for (var i = 0; i < pathLength; i++) {\n        path.push({\n            type: r['type' + i],\n            hash: r['hash' + i]\n        });\n    }\n    return path;\n}\nvar PostgresStore = /** @class */ (function () {\n    function PostgresStore(postgresUri) {\n        this.connectionFactory = new connection_1.ConnectionFactory(postgresUri);\n    }\n    PostgresStore.prototype.save = function (envelopes) {\n        return __awaiter(this, void 0, void 0, function () {\n            var facts_1;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(envelopes.length > 0)) return [3 /*break*/, 2];\n                        facts_1 = envelopes.map(function (e) { return e.fact; });\n                        if (facts_1.some(function (f) { return !f.hash || !f.type; })) {\n                            throw new Error('Attempted to save a fact with no hash or type.');\n                        }\n                        return [4 /*yield*/, this.connectionFactory.withTransaction(function (connection) { return __awaiter(_this, void 0, void 0, function () {\n                                var newFacts;\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, filterNewFacts(facts_1, connection)];\n                                        case 1:\n                                            newFacts = _a.sent();\n                                            return [4 /*yield*/, insertEdges(newFacts, connection)];\n                                        case 2:\n                                            _a.sent();\n                                            return [4 /*yield*/, insertFacts(newFacts, connection)];\n                                        case 3:\n                                            _a.sent();\n                                            return [4 /*yield*/, insertSignatures(envelopes, connection)];\n                                        case 4:\n                                            _a.sent();\n                                            return [2 /*return*/, envelopes.filter(function (envelope) { return newFacts.some(jinaga_1.factReferenceEquals(envelope.fact)); })];\n                                    }\n                                });\n                            }); })];\n                    case 1: return [2 /*return*/, _a.sent()];\n                    case 2: return [2 /*return*/, []];\n                }\n            });\n        });\n    };\n    PostgresStore.prototype.query = function (start, query) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sqlQuery, rows;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (query.steps.length === 0) {\n                            return [2 /*return*/, [[start]]];\n                        }\n                        sqlQuery = sql_1.sqlFromSteps(start, query.steps);\n                        if (!sqlQuery) {\n                            throw new Error(\"Could not generate SQL for query \\\"\" + query.toDescriptiveString() + \"\\\"\");\n                        }\n                        return [4 /*yield*/, this.connectionFactory.with(function (connection) { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, connection.query(sqlQuery.sql, sqlQuery.parameters)];\n                                        case 1: return [2 /*return*/, _a.sent()];\n                                    }\n                                });\n                            }); })];\n                    case 1:\n                        rows = (_a.sent()).rows;\n                        return [2 /*return*/, rows.map(function (row) { return loadFactPath(sqlQuery.pathLength, row); })];\n                }\n            });\n        });\n    };\n    PostgresStore.prototype.exists = function (fact) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sql, parameters, rows;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sql = 'SELECT COUNT(1) AS count FROM public.fact WHERE type=$1 AND hash=$2';\n                        parameters = [fact.type, fact.hash];\n                        return [4 /*yield*/, this.connectionFactory.with(function (connection) { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, connection.query(sql, parameters)];\n                                        case 1: return [2 /*return*/, _a.sent()];\n                                    }\n                                });\n                            }); })];\n                    case 1:\n                        rows = (_a.sent()).rows;\n                        return [2 /*return*/, rows[0].count > 0];\n                }\n            });\n        });\n    };\n    PostgresStore.prototype.load = function (references) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tuples, parameters, sql, rows;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (references.length === 0) {\n                            return [2 /*return*/, []];\n                        }\n                        tuples = references.map(function (r, i) { return '($' + (i * 2 + 1) + ', $' + (i * 2 + 2) + ')'; });\n                        parameters = fn_1.flatten(references, function (r) { return [r.type, r.hash]; });\n                        sql = 'WITH RECURSIVE a(ancestor_hash, ancestor_type, hash, type) AS (' +\n                            ' SELECT v.hash AS ancestor_hash, v.type AS ancestor_type, v.hash, v.type' +\n                            ' FROM (VALUES ' + tuples.join(', ') + ') AS v (type, hash)' +\n                            ' UNION ALL' +\n                            ' SELECT e.predecessor_hash AS ancestor_hash, e.predecessor_type AS ancestor_type, a.hash, a.type' +\n                            ' FROM a' +\n                            ' JOIN public.edge e ON e.successor_hash = a.ancestor_hash AND e.successor_type = a.ancestor_type)' +\n                            ' SELECT fact.type, fact.hash, fact.fields, fact.predecessors' +\n                            ' FROM (SELECT DISTINCT a.ancestor_hash, a.ancestor_type FROM a) AS d' +\n                            ' JOIN public.fact ON d.ancestor_type = fact.type AND d.ancestor_hash = fact.hash;';\n                        return [4 /*yield*/, this.connectionFactory.with(function (connection) { return __awaiter(_this, void 0, void 0, function () {\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, connection.query(sql, parameters)];\n                                        case 1: return [2 /*return*/, _a.sent()];\n                                    }\n                                });\n                            }); })];\n                    case 1:\n                        rows = (_a.sent()).rows;\n                        return [2 /*return*/, rows.map(loadFactRecord)];\n                }\n            });\n        });\n    };\n    return PostgresStore;\n}());\nexports.PostgresStore = PostgresStore;\nfunction filterNewFacts(facts, connection) {\n    return __awaiter(this, void 0, void 0, function () {\n        var factValues, factParameters, rows, newFactReferences_1;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(facts.length > 0)) return [3 /*break*/, 2];\n                    factValues = facts.map(function (f, i) {\n                        return '($' + (i * 2 + 1) + ', $' + (i * 2 + 2) + ')';\n                    });\n                    factParameters = fn_1.flatten(facts, function (f) {\n                        return [f.hash, f.type];\n                    });\n                    return [4 /*yield*/, connection.query('SELECT hash, type' +\n                            '  FROM (VALUES ' + factValues.join(', ') + ') AS v(hash, type)' +\n                            '  WHERE NOT EXISTS (SELECT 1 FROM public.fact' +\n                            '   WHERE fact.hash = v.hash AND fact.type = v.type)', factParameters)];\n                case 1:\n                    rows = (_a.sent()).rows;\n                    newFactReferences_1 = rows.map(loadFactReference);\n                    return [2 /*return*/, facts.filter(function (f) { return newFactReferences_1.some(jinaga_1.factReferenceEquals(f)); })];\n                case 2: return [2 /*return*/, []];\n            }\n        });\n    });\n}\nfunction insertEdges(facts, connection) {\n    return __awaiter(this, void 0, void 0, function () {\n        var edgeRecords, edgeValues, edgeParameters;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    edgeRecords = fn_1.flatten(facts, edge_record_1.makeEdgeRecords);\n                    if (!(edgeRecords.length > 0)) return [3 /*break*/, 2];\n                    edgeValues = edgeRecords.map(function (e, i) {\n                        return '($' + (i * 5 + 1) + ', $' + (i * 5 + 2) + ', $' + (i * 5 + 3) + ', $' + (i * 5 + 4) + ', $' + (i * 5 + 5) + ')';\n                    });\n                    edgeParameters = fn_1.flatten(edgeRecords, function (e) {\n                        return [e.predecessor_hash, e.predecessor_type, e.successor_hash, e.successor_type, e.role];\n                    });\n                    return [4 /*yield*/, connection.query('INSERT INTO public.edge' +\n                            ' (predecessor_hash, predecessor_type, successor_hash, successor_type, role)' +\n                            ' (VALUES ' + edgeValues.join(', ') + ')' +\n                            ' ON CONFLICT DO NOTHING', edgeParameters)];\n                case 1:\n                    _a.sent();\n                    _a.label = 2;\n                case 2: return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction insertFacts(facts, connection) {\n    return __awaiter(this, void 0, void 0, function () {\n        var factValues, factParameters;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!(facts.length > 0)) return [3 /*break*/, 2];\n                    factValues = facts.map(function (f, i) {\n                        return '($' + (i * 4 + 1) + ', $' + (i * 4 + 2) + ', $' + (i * 4 + 3) + ', $' + (i * 4 + 4) + ')';\n                    });\n                    factParameters = fn_1.flatten(facts, function (f) {\n                        return [f.hash, f.type, JSON.stringify(f.fields), JSON.stringify(f.predecessors)];\n                    });\n                    return [4 /*yield*/, connection.query('INSERT INTO public.fact' +\n                            ' (hash, type, fields, predecessors)' +\n                            ' (SELECT hash, type, to_jsonb(fields), to_jsonb(predecessors)' +\n                            '  FROM (VALUES ' + factValues.join(', ') + ') AS v(hash, type, fields, predecessors))' +\n                            ' ON CONFLICT DO NOTHING', factParameters)];\n                case 1:\n                    _a.sent();\n                    _a.label = 2;\n                case 2: return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction insertSignatures(envelopes, connection) {\n    return __awaiter(this, void 0, void 0, function () {\n        var signatureRecords, signatureValues, signatureParameters;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    signatureRecords = fn_1.flatten(envelopes, function (envelope) { return envelope.signatures.map(function (signature) { return ({\n                        type: envelope.fact.type,\n                        hash: envelope.fact.hash,\n                        publicKey: signature.publicKey,\n                        signature: signature.signature\n                    }); }); });\n                    if (!(signatureRecords.length > 0)) return [3 /*break*/, 2];\n                    signatureValues = signatureRecords.map(function (s, i) {\n                        return \"($\" + (i * 4 + 1) + \", $\" + (i * 4 + 2) + \", $\" + (i * 4 + 3) + \", $\" + (i * 4 + 4) + \")\";\n                    });\n                    signatureParameters = fn_1.flatten(signatureRecords, function (s) {\n                        return [s.hash, s.type, s.publicKey, s.signature];\n                    });\n                    return [4 /*yield*/, connection.query(\"INSERT INTO public.signature\\n            (hash, type, public_key, signature) \\n            (SELECT hash, type, public_key, signature \\n            FROM (VALUES \" + signatureValues.join(', ') + \") AS v(hash, type, public_key, signature) \\n            WHERE NOT EXISTS (SELECT 1 FROM public.signature \\n            WHERE signature.hash = v.hash AND signature.type = v.type AND signature.public_key = v.public_key))\\n            ON CONFLICT DO NOTHING\", signatureParameters)];\n                case 1:\n                    _a.sent();\n                    _a.label = 2;\n                case 2: return [2 /*return*/];\n            }\n        });\n    });\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.makeEdgeRecords = void 0;\nfunction makeEdgeRecord(predecessor, successor, role) {\n    if (!predecessor.hash || !predecessor.type || !successor.hash || !successor.type) {\n        throw new Error('Attempting to save edge with null hash or type.');\n    }\n    return {\n        predecessor_hash: predecessor.hash,\n        predecessor_type: predecessor.type,\n        successor_hash: successor.hash,\n        successor_type: successor.type,\n        role: role\n    };\n}\nfunction makeEdgeRecords(fact) {\n    var records = [];\n    var _loop_1 = function (role) {\n        var predecessor = fact.predecessors[role];\n        if (Array.isArray(predecessor)) {\n            records = records.concat(predecessor.map(function (p) { return makeEdgeRecord(p, fact, role); }));\n        }\n        else {\n            records.push(makeEdgeRecord(predecessor, fact, role));\n        }\n    };\n    for (var role in fact.predecessors) {\n        _loop_1(role);\n    }\n    return records;\n}\nexports.makeEdgeRecords = makeEdgeRecords;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sqlFromSteps = void 0;\nvar jinaga_1 = require(\"jinaga\");\nfunction sqlFromSteps(start, steps) {\n    var builder = new QueryBuilder();\n    return builder.buildQuery(start, steps);\n}\nexports.sqlFromSteps = sqlFromSteps;\nvar QueryBuilder = /** @class */ (function () {\n    function QueryBuilder() {\n        this.parameters = [];\n        this.nextAlias = 1;\n    }\n    QueryBuilder.prototype.buildQuery = function (start, steps) {\n        var final = steps.reduce(function (state, step) {\n            return state.transition(step);\n        }, this.stateStart(start));\n        if (!final.parts) {\n            return null;\n        }\n        var sql = this.assembleQueryString(final.parts);\n        var parameters = this.parameters;\n        return { sql: sql, parameters: parameters, pathLength: final.parts.prefixes.length };\n    };\n    QueryBuilder.prototype.assembleQueryString = function (parts) {\n        var select = parts.prefixes.map(function (prefix, i) {\n            return prefix + 'type AS type' + i + ', ' + prefix + 'hash AS hash' + i;\n        }).join(', ');\n        var sql = 'SELECT ' + select + ' ' +\n            parts.fromClause + ' ' + parts.joins + ' WHERE ' + parts.whereClause;\n        return sql;\n    };\n    QueryBuilder.prototype.buildChildQuery = function (prefix, steps) {\n        var final = steps.reduce(function (state, step) {\n            return state.transition(step);\n        }, this.stateSubquery(prefix));\n        return this.assembleChildQueryString(final.parts);\n    };\n    QueryBuilder.prototype.assembleChildQueryString = function (parts) {\n        var sql = 'SELECT 1 ' + parts.fromClause + ' ' + parts.joins + ' WHERE ' + parts.whereClause;\n        return sql;\n    };\n    QueryBuilder.prototype.stateStart = function (start) {\n        var _this = this;\n        return {\n            parts: null,\n            transition: function (step) { return _this.transitionFromStart(start, step); }\n        };\n    };\n    QueryBuilder.prototype.transitionFromStart = function (start, step) {\n        if (step instanceof jinaga_1.Join) {\n            if (step.direction === jinaga_1.Direction.Successor) {\n                return this.handleStartSuccessor(start, step.role);\n            }\n            else if (step.direction === jinaga_1.Direction.Predecessor) {\n                return this.handleStartPredecessor(start, step.role);\n            }\n        }\n        else if (step instanceof jinaga_1.PropertyCondition && step.name === 'type') {\n            return this.handleStartType(start, step.value);\n        }\n        throw new Error(\"Cannot yet handle this query: \" + step.toDeclarativeString());\n    };\n    QueryBuilder.prototype.handleStartSuccessor = function (start, role) {\n        var alias = this.allocateAlias();\n        var prefixes = [alias + '.successor_'];\n        var fromClause = 'FROM public.edge ' + alias;\n        var joins = '';\n        var whereClause = alias + '.predecessor_type = ' + this.addParameter(start.type) +\n            ' AND ' + alias + '.predecessor_hash = ' + this.addParameter(start.hash) +\n            ' AND ' + alias + '.role = ' + this.addParameter(role);\n        var parts = { prefixes: prefixes, fromClause: fromClause, joins: joins, whereClause: whereClause };\n        return this.stateMatched(parts);\n    };\n    QueryBuilder.prototype.handleStartPredecessor = function (start, role) {\n        var alias = this.allocateAlias();\n        var prefixes = [alias + '.predecessor_'];\n        var fromClause = 'FROM public.edge ' + alias;\n        var joins = '';\n        var whereClause = alias + '.successor_type = ' + this.addParameter(start.type) +\n            ' AND ' + alias + '.successor_hash = ' + this.addParameter(start.hash) +\n            ' AND ' + alias + '.role = ' + this.addParameter(role);\n        var parts = { prefixes: prefixes, fromClause: fromClause, joins: joins, whereClause: whereClause };\n        return this.stateMatched(parts);\n    };\n    QueryBuilder.prototype.handleStartType = function (start, type) {\n        if (type === start.type) {\n            return this.stateStart(start);\n        }\n        throw new Error(\"Type does not match: \" + start.type + ' != ' + type);\n    };\n    QueryBuilder.prototype.stateSubquery = function (prefix) {\n        var _this = this;\n        return {\n            parts: null,\n            transition: function (step) { return _this.transitionFromSubquery(prefix, step); }\n        };\n    };\n    QueryBuilder.prototype.transitionFromSubquery = function (prefix, step) {\n        if (step instanceof jinaga_1.Join) {\n            if (step.direction === jinaga_1.Direction.Successor) {\n                return this.handleSubquerySuccessor(prefix, step.role);\n            }\n            else if (step.direction === jinaga_1.Direction.Predecessor) {\n                return this.handleSubqueryPredecessor(prefix, step.role);\n            }\n        }\n        throw new Error(\"Cannot yet handle this query: \" + step.toDeclarativeString());\n    };\n    QueryBuilder.prototype.handleSubquerySuccessor = function (outerPrefix, role) {\n        var alias = this.allocateAlias();\n        var fromClause = 'FROM public.edge ' + alias;\n        var joins = '';\n        var prefixes = [alias + '.successor_'];\n        var whereClause = alias + '.predecessor_type = ' + outerPrefix + 'type' +\n            ' AND ' + alias + '.predecessor_hash = ' + outerPrefix + 'hash' +\n            ' AND ' + alias + '.role = ' + this.addParameter(role);\n        var parts = { prefixes: prefixes, fromClause: fromClause, joins: joins, whereClause: whereClause };\n        return this.stateMatched(parts);\n    };\n    QueryBuilder.prototype.handleSubqueryPredecessor = function (outerPrefix, role) {\n        var alias = this.allocateAlias();\n        var fromClause = 'FROM public.edge ' + alias;\n        var joins = '';\n        var prefixes = [alias + '.predecessor_'];\n        var whereClause = alias + '.successor_type = ' + outerPrefix + 'type' +\n            ' AND ' + alias + '.successor_hash = ' + outerPrefix + 'hash' +\n            ' AND ' + alias + '.role = ' + this.addParameter(role);\n        var parts = { prefixes: prefixes, fromClause: fromClause, joins: joins, whereClause: whereClause };\n        return this.stateMatched(parts);\n    };\n    QueryBuilder.prototype.stateMatched = function (parts) {\n        var _this = this;\n        return {\n            parts: parts,\n            transition: function (step) { return _this.transitionFromMatched(parts, step); }\n        };\n    };\n    QueryBuilder.prototype.transitionFromMatched = function (parts, step) {\n        if (step instanceof jinaga_1.PropertyCondition && step.name === \"type\") {\n            return this.handleMatchedType(parts, step.value);\n        }\n        else if (step instanceof jinaga_1.Join) {\n            if (step.direction === jinaga_1.Direction.Successor) {\n                return this.handleMatchedSuccessor(parts, step.role);\n            }\n            else if (step.direction === jinaga_1.Direction.Predecessor) {\n                return this.handleMatchedPredecessor(parts, step.role);\n            }\n        }\n        else if (step instanceof jinaga_1.ExistentialCondition) {\n            return this.handleMatchedExistentialCondition(parts, step.quantifier, step.steps);\n        }\n        throw new Error(\"Cannot yet handle this query: \" + step.toDeclarativeString());\n    };\n    QueryBuilder.prototype.handleMatchedType = function (parts, type) {\n        var prefix = parts.prefixes[parts.prefixes.length - 1];\n        var whereClause = parts.whereClause +\n            ' AND ' + prefix + 'type = ' + this.addParameter(type);\n        return this.stateMatched({\n            prefixes: parts.prefixes,\n            fromClause: parts.fromClause,\n            joins: parts.joins,\n            whereClause: whereClause\n        });\n    };\n    QueryBuilder.prototype.handleMatchedSuccessor = function (parts, role) {\n        var roleParameter = this.addParameter(role);\n        var priorPrefix = parts.prefixes[parts.prefixes.length - 1];\n        var alias = this.allocateAlias();\n        var joins = parts.joins + ' JOIN public.edge ' + alias +\n            ' ON ' + alias + '.predecessor_hash = ' + priorPrefix + 'hash' +\n            ' AND ' + alias + '.predecessor_type = ' + priorPrefix + 'type';\n        var whereClause = parts.whereClause + ' AND ' + alias + '.role = ' + roleParameter;\n        var prefixes = parts.prefixes.concat([alias + '.successor_']);\n        return this.stateMatched({\n            prefixes: prefixes,\n            fromClause: parts.fromClause,\n            joins: joins,\n            whereClause: whereClause\n        });\n    };\n    QueryBuilder.prototype.handleMatchedPredecessor = function (parts, role) {\n        var roleParameter = this.addParameter(role);\n        var priorPrefix = parts.prefixes[parts.prefixes.length - 1];\n        var alias = this.allocateAlias();\n        var joins = parts.joins + ' JOIN public.edge ' + alias +\n            ' ON ' + alias + '.successor_hash = ' + priorPrefix + 'hash' +\n            ' AND ' + alias + '.successor_type = ' + priorPrefix + 'type';\n        var whereClause = parts.whereClause + ' AND ' + alias + '.role = ' + roleParameter;\n        var prefixes = parts.prefixes.concat([alias + '.predecessor_']);\n        return this.stateMatched({\n            prefixes: prefixes,\n            fromClause: parts.fromClause,\n            joins: joins,\n            whereClause: whereClause\n        });\n    };\n    QueryBuilder.prototype.handleMatchedExistentialCondition = function (parts, quantifier, steps) {\n        var existence = quantifier === jinaga_1.Quantifier.Exists ? 'EXISTS' : 'NOT EXISTS';\n        var prefix = parts.prefixes[parts.prefixes.length - 1];\n        var childQuery = this.buildChildQuery(prefix, steps);\n        var whereClause = parts.whereClause +\n            ' AND ' + existence + ' (' + childQuery + ')';\n        return this.stateMatched({\n            prefixes: parts.prefixes,\n            fromClause: parts.fromClause,\n            joins: parts.joins,\n            whereClause: whereClause\n        });\n    };\n    QueryBuilder.prototype.allocateAlias = function () {\n        return 'e' + this.nextAlias++;\n    };\n    QueryBuilder.prototype.addParameter = function (value) {\n        this.parameters.push(value);\n        return '$' + this.parameters.length;\n    };\n    return QueryBuilder;\n}());\n"],"sourceRoot":""}